在微服务架构中，公共模块通常是指在多个微服务之间共享的功能模块。它们帮助简化开发、减少重复代码，并确保服务之间的一致性。以下是一些常见的公共模块及其功能：

### 1. **身份认证与授权模块（Authentication & Authorization）**

- **功能**：提供统一的用户认证、授权和访问控制。

- 常见技术

  ：

  - **JWT（JSON Web Token）**：常用来在服务之间传递身份信息，确保安全。
  - **OAuth 2.0**：用于外部系统授权和认证。
  - **Spring Security**：为服务提供灵活的身份验证和权限控制。

- 公共模块内容

  ：

  - JWT生成与解析
  - 权限拦截器
  - 用户登录与注册
  - 统一的异常处理

### 2. **日志模块（Logging）**

- **功能**：提供分布式系统中的日志收集、存储和分析功能。

- 常见技术

  ：

  - **Spring Boot Actuator**：暴露应用程序的管理端点和监控指标。
  - **Logback** 或 **SLF4J**：作为日志框架。
  - **ELK Stack**（Elasticsearch, Logstash, Kibana）或 **EFK Stack**（Elasticsearch, Fluentd, Kibana）：集中式日志存储与分析。
  - **Zipkin** 或 **Jaeger**：分布式追踪，帮助调试微服务间的调用关系。

- 公共模块内容

  ：

  - 日志封装（包括日志级别、格式等）
  - 日志收集与上传
  - 异常日志与请求日志自动记录

### 3. **服务发现与注册模块（Service Discovery & Registration）**

- **功能**：管理微服务实例的注册和发现，确保各服务之间的相互通信。

- 常见技术

  ：

  - **Eureka**：Spring Cloud 提供的服务注册与发现工具。
  - **Consul**：HashiCorp 提供的分布式服务发现与配置管理工具。
  - **Zookeeper**：Apache 提供的分布式协调服务。

- 公共模块内容

  ：

  - 服务注册
  - 服务发现
  - 健康检查与监控

### 4. **配置管理模块（Configuration Management）**

- **功能**：集中管理微服务的配置，支持动态更新配置而无需重启服务。

- 常见技术

  ：

  - **Spring Cloud Config**：集中式配置管理，支持 Git、SVN 等版本控制系统。
  - **Consul/Etcd**：作为配置中心。

- 公共模块内容

  ：

  - 配置文件加载与刷新
  - 配置文件管理和版本控制
  - 多环境配置管理（开发、测试、生产环境）

### 5. **API网关模块（API Gateway）**

- **功能**：统一的API入口，处理外部请求，路由到对应的微服务。

- 常见技术

  ：

  - **Spring Cloud Gateway**：Spring Cloud 提供的 API 网关。
  - **Zuul**：Netflix 提供的 API 网关，已被 Spring Cloud Gateway 替代。
  - **Kong**：开源的API网关解决方案。

- 公共模块内容

  ：

  - 路由与负载均衡
  - 统一认证与授权
  - 请求限流与熔断
  - 请求日志与监控

### 6. **负载均衡与容错模块（Load Balancing & Fault Tolerance）**

- **功能**：确保系统的高可用性和稳定性，处理服务调用的故障和负载分配。

- 常见技术

  ：

  - **Ribbon**：客户端负载均衡。
  - **Hystrix**：实现熔断和隔离，保证系统的容错能力（已弃用，建议使用 Resilience4j）。
  - **Resilience4j**：用于实现熔断、重试、限流等容错处理。

- 公共模块内容

  ：

  - 负载均衡配置
  - 熔断与回退机制
  - 重试机制
  - 超时管理

### 7. **消息队列与事件驱动模块（Message Queues & Event-Driven）**

- **功能**：实现微服务之间的异步通信，解耦服务间的直接依赖。

- 常见技术

  ：

  - **Kafka**：分布式流处理平台，用于处理大量的消息和事件。
  - **RabbitMQ**：一个支持多种消息协议的消息队列。
  - **ActiveMQ**：开源消息中间件。
  - **RocketMQ**：阿里巴巴的分布式消息中间件。

- 公共模块内容

  ：

  - 消息生产与消费
  - 事件发布与订阅
  - 异常事件和消息重试
  - 消息队列连接与配置

### 8. **数据库操作与持久化模块（Database & Persistence）**

- **功能**：为微服务提供统一的数据访问接口，常常包含事务管理、数据迁移等功能。

- 常见技术

  ：

  - **Spring Data JPA** 或 **MyBatis**：用于数据库的访问层。
  - **Flyway** 或 **Liquibase**：数据库迁移工具。

- 公共模块内容

  ：

  - 数据库连接池配置
  - 实体类与持久化操作封装
  - 数据库迁移与版本控制
  - 分布式事务（若需要）

### 9. **统一异常处理模块（Global Exception Handling）**

- **功能**：集中处理应用中的所有异常，提供统一的异常响应结构。

- 常见技术

  ：

  - **Spring `@ControllerAdvice`**：处理全局异常。
  - 自定义异常类（例如 `CustomException`）和异常处理器。

- 公共模块内容

  ：

  - 异常类型的封装与响应
  - 错误信息格式化（比如 JSON 格式）
  - 日志记录异常信息

### 10. **监控与追踪模块（Monitoring & Tracing）**

- **功能**：监控微服务的健康状态、性能指标，支持分布式追踪。

- 常见技术

  ：

  - **Spring Boot Actuator**：提供健康检查、性能指标、应用监控等功能。
  - **Prometheus + Grafana**：监控和可视化。
  - **Zipkin** 或 **Jaeger**：分布式追踪工具。

- 公共模块内容

  ：

  - 健康检查
  - 性能指标收集
  - 分布式追踪配置

### 11. **文件存储与处理模块（File Storage & Processing）**

- **功能**：为微服务提供文件上传、存储和处理能力。

- 常见技术

  ：

  - **MinIO** 或 **Amazon S3**：对象存储。
  - **FastDFS**：分布式文件系统。
  - **Multipart 文件上传**：Spring 提供的文件上传接口。

- 公共模块内容

  ：

  - 文件上传与下载
  - 文件存储路径管理
  - 大文件处理和切割

### 总结

微服务架构中，公共模块通常包括认证、日志、配置管理、服务发现、API 网关、负载均衡、容错、消息队列、数据库操作、异常处理、监控与追踪、文件存储等。这些模块有助于规范化微服务的开发与管理，减少冗余代码，提高开发效率和系统的可维护性。
